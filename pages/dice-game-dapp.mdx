# DiceGameDapp

A simple Dice Game DApp powered by FHEVM smart contracts with fully homomorphic encryption.

## Prerequisites

- Basic understanding of creating and initializing React-based projects
- Node.js & npm/pnpm
- Familiarity with Hardhat & Ethers.js
- FHEVM SDK & Hardhat Plugin
- Knowledge of wallet integration (MetaMask.js/Ethers.js) for connecting wallet extensions to DApps

## Project Structure
::::steps
### Frontend Directory Structure

```
frontend/
â”œâ”€â”€ node_modules/
â”œâ”€â”€ public/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ Playground.js
â”‚   â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ App.css
â”‚   â”œâ”€â”€ App.js
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ pnpm-lock.yaml
â””â”€â”€ README.md
```

### Directory Overview

- **`node_modules/`** - Dependencies installed by npm/pnpm
- **`public/`** - Static assets and HTML template
- **`src/`** - Source code directory
  - **`components/`** - Reusable React components (including Playground component)
  - **`hooks/`** - Custom React hooks for wallet connection and FHEVM integration
  - **`App.css`** - Main application styles
  - **`App.js`** - Main App component
  - **`index.js`** - Application entry point
- **`package.json`** - Project configuration and dependencies
- **`package-lock.json`** - Locked dependency versions (npm)
- **`pnpm-lock.yaml`** - Locked dependency versions (pnpm)


### Initiate a new project

``` js
npx create-react-app frontend
cd frontend
```
Now Install the required dependencies
``` js
npm install @zama-fhe/relayer-sdk@^0.2.0 ethers@^6.15.0
npm install react@^19.1.1 react-dom@^19.1.1
npm install --save-dev @testing-library/dom@^10.4.1 @testing-library/jest-dom@^6.8.0 @testing-library/react@^16.3.0 @testing-library/user-event@^13.5.0
```

### Update the project code
Under Public/index.HTML
Replace with
``` html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/dice-icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#ff6b6b" />
    <meta
      name="description"
      content="FHEVM Dice Game - Your first confidential dice game with Zama FHEVM. A privacy-focused dice game built with blockchain technology where dice rolls are encrypted and results remain private until revealed."
    />
    <meta name="keywords" content="dice game, blockchain, FHEVM, Zama, confidential, ethereum, smart contract, privacy, crypto, gambling, dice roll" />
    <meta name="author" content="FHEVM Dice Game" />
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
    <meta property="og:title" content="FHEVM Dice Game - Confidential Gaming" />
    <meta property="og:description" content="A privacy-focused dice game built with Zama FHEVM technology. Experience confidential gaming where your rolls remain private!" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="%PUBLIC_URL%/dice-preview.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="FHEVM Dice Game - Confidential Gaming" />
    <meta name="twitter:description" content="A privacy-focused dice game built with Zama FHEVM technology. Roll the dice with complete privacy!" />
    <meta name="twitter:image" content="%PUBLIC_URL%/dice-preview.png" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/dice-icon.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Zama FHEVM Relayer SDK -->
    <script src="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs" type="text/javascript" crossorigin="anonymous"></script>
    
    <!-- Dice Game Favicon and Icons -->
    <link rel="shortcut icon" href="%PUBLIC_URL%/dice-icon.png" type="image/png" />
    
    <!-- Preload important assets -->
    <link rel="preload" href="%PUBLIC_URL%/dice-sounds.mp3" as="audio" />
    
    <title>FHEVM Dice Game - Confidential Gaming DApp</title>
  </head>
  <body>
    <noscript>
      <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
        <h2>ğŸ² FHEVM Dice Game</h2>
        <p>You need to enable JavaScript to roll the dice and play this confidential game.</p>
        <p>Please enable JavaScript in your browser settings to continue.</p>
      </div>
    </noscript>
    <div id="root"></div>
    <!--
      Welcome to FHEVM Dice Game!
      
      This is a confidential dice game built with Zama's FHEVM technology.
      Features:
      - Encrypted dice rolls for complete privacy
      - Fair and verifiable randomness
      - Blockchain-based smart contracts
      - Real-time gameplay with instant results
      
      To begin development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
      
      ğŸ² Roll the dice and experience privacy-preserving gaming!
    -->
  </body>
</html>
```
Under src/App.js
to
``` js
import React, { useState } from 'react';
import Header from './components/Header';
import WalletConnect from './components/WalletConnect';
// Lottery-specific components removed from rendering
// import LotteryStats from './components/LotteryStats';
// import BuyTicket from './components/BuyTicket';
// import WinnerDisplay from './components/WinnerDisplay';

import ContractInfo from './components/ContractInfo';
import Footer from './components/Footer';
import ToastContainer from './components/ToastContainer';
import StatusMessage from './components/StatusMessage';
// import { useLottery } from './hooks/useLottery';
import { useWallet } from './hooks/useWallet';
import { useToast } from './hooks/useToast';
import { useDiceGame } from './hooks/useDiceGame';
import PlayDice from './components/PlayDice';
import DiceResults from './components/DiceResults';

function App() {
  const [txStatus, setTxStatus] = useState('');

  // FHEDiceGame contract address - update to your deployed address
  const contractAddress = "0xA6915c97f44f1708e37dD871CCE991fD6D45E943";

  const { messages, showToast } = useToast();
  const { account, isConnected, connectWallet } = useWallet(showToast, contractAddress);
  const {
    loading,
    encryptedState,
    decryptedState,
    playDice,
    refreshEncryptedState,
    decryptLastDiceRoll,
    decryptPlayerGuess,
    decryptWinnerStatus
  } = useDiceGame(account, showToast, setTxStatus, contractAddress);

  return (
    <div className="app">
      <div className="container">
        <div className="app-content">
          <Header />

          <ToastContainer messages={messages} />

          {/* Wallet Connection Section */}
          <div className="section wallet-section">
            <WalletConnect
              isConnected={isConnected}
              account={account}
              onConnect={connectWallet}
              txStatus={txStatus}
              loading={loading}
            />

            {isConnected && txStatus && (
              <StatusMessage type="info">
                <strong>Transaction in progress:</strong> {txStatus}
              </StatusMessage>
            )}
          </div>

          {isConnected && (
            <>
              <div className="section actions-section">
                <PlayDice loading={loading} onPlay={playDice} />
                <DiceResults
                  encrypted={encryptedState}
                  decrypted={decryptedState}
                  onDecryptRoll={decryptLastDiceRoll}
                  onDecryptGuess={decryptPlayerGuess}
                  onDecryptWinner={decryptWinnerStatus}
                  loading={loading}
                />
              </div>

              <div className="section contract-section">
                <ContractInfo contractAddress={contractAddress} />
              </div>
            </>
          )}
        </div>
      </div>
      <Footer />
    </div>
  );
}

export default App;
```
Under src/Index.js
```js
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.js';
import './App.css';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

```

### Now create a Component on the root of the project of src, as src/components
``` js
mkdir components
   
# Create all these component files
touch ContractInfo.js
touch Header.js
touch StatusMessage.js
touch DiceResults.js
touch PastRounds.js
touch ToastContainer.js
touch Footer.js
touch PlayDice.js
touch WalletConnect.js
 ```

 # Replace the files with these 
ContractInfo.js
``` js
const ContractInfo = ({ contractAddress }) => {
  return (
    <div className="card-secondary">
      <h3 style={{ marginBottom: '12px', fontSize: '1.125rem', color: 'var(--text-secondary)' }}>ğŸ“‹ Contract Information</h3>
      <hr style={{ borderColor: 'var(--border-light)', marginBottom: '16px' }} />

      {/* Educational Content */}
      <div style={{ background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%)', padding: '12px', borderRadius: '8px', marginBottom: '16px', border: '1px solid var(--info-color)' }}>
        <h4 style={{ margin: '0 0 8px 0', fontSize: '0.9rem', color: 'var(--info-color)' }}>ğŸ” What is FHEVM?</h4>
        <p style={{ margin: '0', fontSize: '0.75rem', color: 'var(--text-secondary)', lineHeight: '1.4' }}>
          <strong>Fully Homomorphic Encryption Virtual Machine</strong> enables computations on encrypted data without decryption.
          Your lottery ticket is mathematically encrypted - only you know your number!
        </p>
      </div>

      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
        <span style={{ color: 'var(--text-secondary)' }}>Contract Address:</span>
        <a
          href={`https://sepolia.etherscan.io/address/${contractAddress}`}
          target="_blank"
          rel="noopener noreferrer"
          style={{
            fontFamily: 'monospace',
            color: 'var(--primary-color)',
            fontSize: '0.875rem',
            textDecoration: 'none',
            cursor: 'pointer'
          }}
          onMouseEnter={(e) => e.target.style.textDecoration = 'underline'}
          onMouseLeave={(e) => e.target.style.textDecoration = 'none'}
        >
          {contractAddress.slice(0, 10)}...{contractAddress.slice(-8)}
        </a>
      </div>

      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
        <span style={{ color: 'var(--text-secondary)' }}>Network:</span>
        <span className="badge" style={{ background: 'var(--secondary-color)', padding: '2px 8px', fontSize: '0.75rem' }}>
          Sepolia Testnet
        </span>
      </div>

      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>
        <span style={{ color: 'var(--text-secondary)' }}>Technology:</span>
        <span className="badge" style={{ background: 'var(--warning-color)', padding: '2px 8px', fontSize: '0.75rem' }}>
          ğŸ”’ FHEVM
        </span>
      </div>

      <div style={{ display: 'flex', justifyContent: 'space-between' }}>
        <span style={{ color: 'var(--text-secondary)' }}>Privacy:</span>
        <span className="badge" style={{ background: 'var(--success-color)', padding: '2px 8px', fontSize: '0.75rem' }}>
          ğŸ›¡ï¸ Mathematical
        </span>
      </div>
    </div>
  );
};

export default ContractInfo;
```

Header.js
```js
const Header = () => {
  return (
    <header className="header">
      <div className="header-content">
        <div style={{ display: 'flex', justifyContent: 'center', gap: '8px', marginBottom: '8px' }}>
          <span className="badge">FHEVM</span>
          <span className="badge">Private</span>
        </div>
        <h1 className="title" style={{
          background: 'linear-gradient(90deg, var(--secondary-color), var(--primary-color))',
          WebkitBackgroundClip: 'text',
          WebkitTextFillColor: 'transparent'
        }}>
          Neon Dice â€” Confidential Rolls
        </h1>
        <p className="subtitle">
          Pick a face or go random. We encrypt your guess client-side and compute on-chain.
        </p>
      </div>
    </header>
  );
};

export default Header;

```
StatusMessage.js
```js

const StatusMessage = ({ children, type = 'info' }) => {
  return (
    <div className={`status-message status-${type}`}>
      {children}
    </div>
  );
};

export default StatusMessage;

```

DiceResults.js
```js

const DiceResults = ({
  encrypted,
  decrypted,
  onDecryptRoll,
  onDecryptGuess,
  onDecryptWinner,
  loading
}) => {
  return (
    <div className="card" style={{ maxWidth: '600px', margin: '16px auto 0' }}>
      <h3 style={{ marginBottom: '12px', fontSize: '1.1rem', color: 'var(--text-primary)' }}>ğŸ” Encrypted Results</h3>

      <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div>
            <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)' }}>Last Dice Roll (enc)</div>
            <div style={{ fontFamily: 'monospace', fontSize: '0.8rem' }}>{encrypted.lastDiceRoll}</div>
          </div>
          <div>
            <button
              onClick={onDecryptRoll}
              disabled={loading}
              className={`btn ${loading ? 'btn-loading' : 'btn-secondary'}`}
              style={{ fontSize: '0.8rem' }}
            >
              ğŸ”“ Decrypt
            </button>
            {decrypted.lastDiceRoll != null && (
              <div style={{ marginTop: '4px', textAlign: 'right' }}>â¡ï¸ {decrypted.lastDiceRoll}</div>
            )}
          </div>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div>
            <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)' }}>Your Guess (enc)</div>
            <div style={{ fontFamily: 'monospace', fontSize: '0.8rem' }}>{encrypted.playerGuess}</div>
          </div>
          <div>
            <button
              onClick={onDecryptGuess}
              disabled={loading}
              className={`btn ${loading ? 'btn-loading' : 'btn-secondary'}`}
              style={{ fontSize: '0.8rem' }}
            >
              ğŸ”“ Decrypt
            </button>
            {decrypted.playerGuess != null && (
              <div style={{ marginTop: '4px', textAlign: 'right' }}>â¡ï¸ {decrypted.playerGuess}</div>
            )}
          </div>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div>
            <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)' }}>Winner Status (enc)</div>
            <div style={{ fontFamily: 'monospace', fontSize: '0.8rem' }}>{encrypted.winnerStatus}</div>
          </div>
          <div>
            <button
              onClick={onDecryptWinner}
              disabled={loading}
              className={`btn ${loading ? 'btn-loading' : 'btn-secondary'}`}
              style={{ fontSize: '0.8rem' }}
            >
              ğŸ”“ Decrypt
            </button>
            {decrypted.winnerStatus != null && (
              <div style={{ marginTop: '4px', textAlign: 'right' }}>
                â¡ï¸ {decrypted.winnerStatus ? 'ğŸ‰ Winner' : 'Not winner'}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default DiceResults;
```
PastRounds.js
```js
const PastRounds = ({ pastRounds, account, onClaimPastPrize, loading }) => {
  if (!pastRounds || pastRounds.length === 0) return null;

  return (
    <div className="card" style={{ maxWidth: '600px', margin: '20px auto 0' }}>
      <h3 style={{ marginBottom: '16px', fontSize: '1.1rem', color: 'var(--text-primary)' }}>ğŸ“œ Past Rounds</h3>

      <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
        {pastRounds.map((round) => {
          const isWinner = round.winner.toLowerCase() === account.toLowerCase();
          const canClaim = isWinner && !round.claimed;

          return (
            <div
              key={round.index}
              style={{
                padding: '12px',
                border: '1px solid var(--border-color)',
                borderRadius: '8px',
                backgroundColor: 'var(--bg-secondary)'
              }}
            >
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                <span style={{ fontWeight: 'bold', color: 'var(--text-primary)' }}>
                  Round #{round.index + 1}
                </span>
                <span style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>
                  {new Date(round.drawTime * 1000).toLocaleDateString()}
                </span>
              </div>

              <div style={{ marginBottom: '8px' }}>
                <span style={{ color: 'var(--text-secondary)' }}>Winner: </span>
                <span style={{ fontFamily: 'monospace', fontSize: '0.9rem' }}>
                  {round.winner.slice(0, 6)}...{round.winner.slice(-4)}
                </span>
              </div>

              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span style={{ color: 'var(--text-secondary)' }}>
                  Prize: {round.prize} ETH
                </span>

                {isWinner ? (
                  round.claimed ? (
                    <span style={{ color: 'var(--success-color)', fontSize: '0.9rem' }}>âœ… Claimed</span>
                  ) : (
                    <button
                      onClick={() => onClaimPastPrize(round.index)}
                      disabled={loading}
                      className="btn btn-success"
                      style={{ fontSize: '0.8rem', padding: '4px 8px' }}
                    >
                      {loading ? 'ğŸ’° Claiming...' : 'ğŸ’° Claim Prize'}
                    </button>
                  )
                ) : (
                  <span style={{ color: 'var(--text-secondary)', fontSize: '0.9rem' }}>
                    Better luck next time! ğŸ¯
                  </span>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

export default PastRounds;

```
ToastContainer.js
```js
const ToastContainer = ({ messages }) => {
  return (
    <div className="toast-container">
      {messages.map(msg => (
        <div key={msg.id} className={`toast toast-${msg.type}`}>
          {msg.message}
        </div>
      ))}
    </div>
  );
};

export default ToastContainer;

```

Footer.js
```js
const Footer = () => {
  return (
    <footer className="footer" style={{ backdropFilter: 'blur(8px)' }}>
      <div className="footer-content" style={{ justifyContent: 'center', gap: '16px' }}>
        <div className="footer-text" style={{ textAlign: 'center' }}>
          <p>Neon Dice â€¢ Built with React + FHEVM</p>
        </div>
        <div className="footer-links" style={{ gap: '12px' }}>
          <a
            href="https://github.com/NecipAkgz/hello-fhevm-lottery"
            target="_blank"
            rel="noopener noreferrer"
            className="footer-link"
          >
            GitHub
          </a>
          <a
            href="https://x.com/LanceNeop"
            target="_blank"
            rel="noopener noreferrer"
            className="footer-link"
          >
            Twitter
          </a>
        </div>
      </div>
    </footer>
  );
};

export default Footer;
```
PlayDice.js


```js
import { useEffect, useRef, useState } from 'react';

const faces = [1, 2, 3, 4, 5, 6];

const PlayDice = ({ loading, onPlay }) => {
  const [seed, setSeed] = useState('');
  const [guess, setGuess] = useState(1);
  const [capturing, setCapturing] = useState(false);
  const [captureProgress, setCaptureProgress] = useState(0);
  const entropyRef = useRef([]);
  const areaRef = useRef(null);
  const [rolling, setRolling] = useState(false);
  const [currentFace, setCurrentFace] = useState(1);
  const [entropyReady, setEntropyReady] = useState(false);
  const [userPicked, setUserPicked] = useState(false);

  // Simple 32-bit hash of a string
  const hash32 = (str) => {
    let h = 2166136261 >>> 0; // FNV-1a
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return (h >>> 0) % 0xffffffff;
  };

  // Start 2s mouse entropy capture
  const startEntropyCapture = () => {
    if (capturing) return;
    entropyRef.current = [];
    setCaptureProgress(0);
    setCapturing(true);
    setEntropyReady(false);

    const onMove = (e) => {
      const rect = areaRef.current?.getBoundingClientRect();
      const x = rect ? e.clientX - rect.left : e.clientX;
      const y = rect ? e.clientY - rect.top : e.clientY;
      entropyRef.current.push(`${x},${y},${e.timeStamp}`);
    };

    const area = areaRef.current || window;
    area.addEventListener('mousemove', onMove);

    const start = Date.now();
    const interval = setInterval(() => {
      const elapsed = Date.now() - start;
      setCaptureProgress(Math.min(100, Math.round((elapsed / 2000) * 100)));
    }, 100);

    setTimeout(() => {
      area.removeEventListener('mousemove', onMove);
      clearInterval(interval);
      setCapturing(false);
      const data = entropyRef.current.join('|');
      const h = hash32(data);
      // Map to a reasonably large uint range for seed
      const seedNum = h % 1000000007; // prime mod
      setSeed(String(seedNum));
      setEntropyReady(true);
    }, 2000);
  };

  const disabled = loading || !seed || Number(guess) < 1 || Number(guess) > 6;

  return (
    <div className="card" style={{ maxWidth: '640px', margin: '0 auto', padding: '24px' }}>
      <h3 style={{ textAlign: 'center', color: 'var(--text-secondary)', fontWeight: 500, marginBottom: '16px' }}>Roll the dice and see what you get!</h3>

      <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', alignItems: 'center' }}>
        <div className="dice-stage" onMouseEnter={() => { if (!capturing && !entropyReady) startEntropyCapture(); }}>
          <div
            className={`dice-cube ${rolling ? 'dice-rolling' : ''}`}
            style={{
              transform: rolling ? undefined : (
                currentFace === 1 ? 'rotateY(0deg)' :
                currentFace === 2 ? 'rotateY(-90deg)' :
                currentFace === 3 ? 'rotateY(-180deg)' :
                currentFace === 4 ? 'rotateY(90deg)' :
                currentFace === 5 ? 'rotateX(-90deg)' :
                'rotateX(90deg)'
              )
            }}
          >
            <div className="dice-face face-1">âš€</div>
            <div className="dice-face face-2">âš</div>
            <div className="dice-face face-3">âš‚</div>
            <div className="dice-face face-4">âšƒ</div>
            <div className="dice-face face-5">âš„</div>
            <div className="dice-face face-6">âš…</div>
          </div>
        </div>

        {/* Guess selector: click chips to choose face */}
        <div style={{ display: 'flex', gap: '8px' }}>
          {faces.map(f => (
            <button
              key={f}
              onClick={() => { setGuess(f); setCurrentFace(f); setUserPicked(true); }}
              className={`btn ${guess === f ? 'btn-primary' : 'btn-secondary'}`}
              style={{ padding: '6px 10px' }}
              disabled={loading}
            >
              {['âš€','âš','âš‚','âšƒ','âš„','âš…'][f-1]}
            </button>
          ))}
        </div>

        {/* Entropy indicator */}
        <div style={{ width: '100%', maxWidth: '520px' }}>
          <div style={{ height: '44px', position: 'relative' }}>
            <button
              onClick={async () => {
                // If user didn't pick, choose random face now
                const chosen = userPicked ? guess : (Math.floor(Math.random() * 6) + 1);
                if (!userPicked) {
                  setGuess(chosen);
                  setCurrentFace(chosen);
                }
                // ensure some extra movement during roll
                setRolling(true);
                const timer = setInterval(() => setCurrentFace(prev => (prev % 6) + 1), 90);
                await new Promise(r => setTimeout(r, 1200));
                clearInterval(timer);
                setRolling(false);
                onPlay(Number(seed || Date.now()), Number(chosen));
              }}
              disabled={loading || !entropyReady}
              className={`btn ${loading ? 'btn-loading' : 'btn-primary'}`}
              style={{ width: '100%' }}
            >
              {loading ? 'Encrypting & Playing...' : (entropyReady ? (userPicked ? 'âš¡ Roll Your Pick' : 'âš¡ Roll Dice (Random)') : `Move mouse to unlock (${captureProgress}%)`)}
            </button>
          </div>
        </div>
      </div>

      {/* Hidden entropy capture area to track movement across the card */}
      <div ref={areaRef} style={{ width: '100%', height: 1 }} />
    </div>
  );
};

export default PlayDice;

```
WalletConnect.js
```js
import React from 'react';

const WalletConnect = ({ isConnected, account, onConnect, txStatus, pastRounds, onClaimPastPrize, loading }) => {
  const [showPastRounds, setShowPastRounds] = React.useState(false);

  if (isConnected) {
    return (
      <div>
        {/* Connected Account */}
        <div className="card">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <div>
              <div style={{ fontSize: '0.875rem', color: 'var(--text-secondary)' }}>Connected Account</div>
              <div style={{ fontWeight: 'bold' }}>
                {account.slice(0, 6)}...{account.slice(-4)}
              </div>
            </div>
            <span className="badge" style={{ background: 'var(--success-color)' }}>
              âœ… Connected
            </span>
          </div>
        </div>

        {/* Past Rounds Section */}
        {pastRounds && pastRounds.length > 0 && (
          <div className="card" style={{ marginTop: '16px' }}>
            <div
              style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                cursor: 'pointer',
                padding: '12px'
              }}
              onClick={() => setShowPastRounds(!showPastRounds)}
            >
              <div style={{ fontSize: '0.875rem', fontWeight: 'bold', color: 'var(--text-primary)' }}>
                ğŸ“œ Past Rounds ({pastRounds.length})
              </div>
              <span style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>
                {showPastRounds ? 'â–¼' : 'â–¶'}
              </span>
            </div>

            {showPastRounds && (
              <div style={{ padding: '0 12px 12px 12px' }}>
                <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', maxHeight: '200px', overflowY: 'auto' }}>
                  {pastRounds.map((round) => {
                    const isWinner = round.winner.toLowerCase() === account.toLowerCase();
                    const canClaim = isWinner && !round.claimed;

                    return (
                      <div
                        key={round.index}
                        style={{
                          padding: '8px',
                          border: '1px solid var(--border-color)',
                          borderRadius: '6px',
                          backgroundColor: 'var(--bg-secondary)',
                          fontSize: '0.8rem'
                        }}
                      >
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>
                          <span style={{ fontWeight: 'bold', color: 'var(--text-primary)' }}>
                            Round #{round.index + 1}
                          </span>
                          <span style={{ color: 'var(--text-secondary)' }}>
                            {new Date(round.drawTime * 1000).toLocaleDateString()}
                          </span>
                        </div>

                        <div style={{ marginBottom: '4px' }}>
                          <span style={{ color: 'var(--text-secondary)' }}>Winner: </span>
                          <span style={{ fontFamily: 'monospace' }}>
                            {round.winner.slice(0, 4)}...{round.winner.slice(-4)}
                          </span>
                        </div>

                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <span style={{ color: 'var(--text-secondary)' }}>
                            Prize: {round.prize} ETH
                          </span>

                          {isWinner ? (
                            round.claimed ? (
                              <span style={{ color: 'var(--success-color)', fontSize: '0.75rem' }}>âœ… Claimed</span>
                            ) : (
                              <button
                                onClick={() => onClaimPastPrize(round.index)}
                                disabled={loading}
                                className="btn btn-success"
                                style={{ fontSize: '0.7rem', padding: '2px 6px' }}
                              >
                                {loading ? 'ğŸ’° ...' : 'ğŸ’° Claim'}
                              </button>
                            )
                          ) : (
                            <span style={{ color: 'var(--text-secondary)', fontSize: '0.75rem' }}>
                              Better luck!
                            </span>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    );
  }

  return (
    <div className="card-priority" style={{ maxWidth: '500px', margin: '0 auto', textAlign: 'center' }}>
      <h2 style={{ fontSize: '1.25rem', marginBottom: '12px', color: 'var(--primary-color)' }}>Connect Your Wallet</h2>
      <p style={{ color: 'var(--text-secondary)', marginBottom: '16px', fontSize: '0.875rem' }}>
        Connect your MetaMask wallet to participate in the confidential lottery
      </p>

      {/* App Description */}
      <div className="card-secondary" style={{
        borderRadius: '8px',
        padding: '12px',
        marginBottom: '20px',
        textAlign: 'left'
      }}>
        <h3 style={{ fontSize: '0.9rem', marginBottom: '6px', color: 'var(--text-primary)' }}>
          ğŸ¯ What is Confidential Lottery?
        </h3>
        <p style={{ fontSize: '0.8rem', color: 'var(--text-secondary)', marginBottom: '6px' }}>
          A privacy-focused lottery built with Zama FHEVM technology where:
        </p>
        <ul style={{ fontSize: '0.8rem', color: 'var(--text-secondary)', paddingLeft: '16px', marginBottom: '0' }}>
          <li>ğŸ« Buy tickets with encrypted numbers (0.0001 ETH)</li>
          <li>ğŸ² Admin draws winner randomly on blockchain</li>
          <li>ğŸ’° Only winner can claim the prize pool</li>
        </ul>
      </div>

      <button
        onClick={onConnect}
        disabled={txStatus === 'Connecting...'}
        className={`btn ${txStatus === 'Connecting...' ? 'btn-loading' : 'btn-primary'}`}
        style={{ minWidth: '200px' }}
      >
        {txStatus === 'Connecting...' ? 'ğŸ”„ Connecting...' : 'ğŸ”— Connect MetaMask'}
      </button>
    </div>
  );
};

export default WalletConnect;
```

### Now Let's proceed with the hooks setup
``` js
mkdir hooks

# Create all files
touch useDiceGame.js
touch useToast.js
touch useWallet.js

 ```

 Now replace the files with this snippets
 useDiceGame.js
``` js
import { useEffect, useState } from 'react';
import { BrowserProvider, Contract, parseEther, hexlify } from 'ethers';

// Hook for interacting with FHEDiceGame contract
export const useDiceGame = (account, showToast, setTxStatus, contractAddress) => {
  const [contract, setContract] = useState(null);
  const [loading, setLoading] = useState(false);
  const [entryFeeWei, setEntryFeeWei] = useState(null);
  const [encryptedState, setEncryptedState] = useState({
    lastDiceRoll: '0x',
    playerGuess: '0x',
    winnerStatus: '0x'
  });
  const [decryptedState, setDecryptedState] = useState({
    lastDiceRoll: null,
    playerGuess: null,
    winnerStatus: null
  });

  const abi = [
    "function ENTRY_FEE() view returns (uint256)",
    "function owner() view returns (address)",
    "function getLastDiceRoll() view returns (bytes32)",
    "function getPlayerGuess() view returns (bytes32)",
    "function getWinnerStatus() view returns (bytes32)",
    "function playDice(bytes32,bytes,bytes32,bytes) payable",
    "function withdraw()"
  ];

  useEffect(() => {
    if (!account || !window.ethereum) return;
    const init = async () => {
      try {
        const provider = new BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        const c = new Contract(contractAddress, abi, signer);
        setContract(c);
        try {
          const fee = await c.ENTRY_FEE();
          setEntryFeeWei(fee);
        } catch {}
        await refreshEncryptedState(c);
      } catch (err) {
        console.error('Error initializing FHEDiceGame contract:', err);
      }
    };
    init();
  }, [account, contractAddress]);

  const refreshEncryptedState = async (c) => {
    try {
      const [lastDiceRoll, playerGuess, winnerStatus] = await Promise.all([
        (c || contract).getLastDiceRoll(),
        (c || contract).getPlayerGuess(),
        (c || contract).getWinnerStatus()
      ]);
      setEncryptedState({
        lastDiceRoll,
        playerGuess,
        winnerStatus
      });
    } catch (err) {
      console.error('Failed to load encrypted state:', err);
    }
  };

  const playDice = async (seedNumber, guessNumber) => {
    if (!contract) return;
    if (
      typeof seedNumber !== 'number' || Number.isNaN(seedNumber) ||
      typeof guessNumber !== 'number' || Number.isNaN(guessNumber) ||
      guessNumber < 1 || guessNumber > 6
    ) {
      showToast('Enter a valid seed and a guess between 1-6', 'warning');
      return;
    }

    setLoading(true);
    setTxStatus('Encrypting seed and guess...');
    try {
      // Initialize FHEVM Relayer SDK
      await window.relayerSDK.initSDK();
      const config = { ...window.relayerSDK.SepoliaConfig, network: window.ethereum };
      const fhevm = await window.relayerSDK.createInstance(config);

      if (!window.relayerSDK) throw new Error('Relayer SDK not loaded');

      // Prepare encrypted inputs (handles + proofs) using add32 flow
      const seedInput = await fhevm.createEncryptedInput(contractAddress, account);
      await seedInput.add32(seedNumber);
      const seedEnc = await seedInput.encrypt();

      const guessInput = await fhevm.createEncryptedInput(contractAddress, account);
      await guessInput.add32(guessNumber);
      const guessEnc = await guessInput.encrypt();

      // Extract handles and proofs in a robust way
      const firstSeed = (seedEnc.handles && seedEnc.handles[0]) || seedEnc.handle || seedEnc.inputHandle;
      const firstGuess = (guessEnc.handles && guessEnc.handles[0]) || guessEnc.handle || guessEnc.inputHandle;
      let seedHandle = typeof firstSeed === 'object' && firstSeed?.handle ? firstSeed.handle : firstSeed;
      let guessHandle = typeof firstGuess === 'object' && firstGuess?.handle ? firstGuess.handle : firstGuess;
      let seedProof = seedEnc.inputProof || seedEnc.proof;
      let guessProof = guessEnc.inputProof || guessEnc.proof;

      // Normalize to hex strings (0x...)
      const toHex = (v) => {
        if (!v) return v;
        if (typeof v === 'string') return v.startsWith('0x') ? v : `0x${v}`;
        try { return hexlify(v); } catch { return v; }
      };
      const padToBytes32 = (hex) => {
        if (!hex) return hex;
        let h = hex.toLowerCase();
        if (!h.startsWith('0x')) h = `0x${h}`;
        h = h.replace(/^0x/, '');
        if (h.length > 64) h = h.slice(h.length - 64); // keep last 32 bytes
        return '0x' + h.padStart(64, '0');
      };
      seedHandle = toHex(seedHandle);
      guessHandle = toHex(guessHandle);
      seedProof = toHex(seedProof);
      guessProof = toHex(guessProof);

      // Ensure handles are exactly bytes32
      seedHandle = padToBytes32(seedHandle);
      guessHandle = padToBytes32(guessHandle);

      if (!seedHandle || !seedProof || !guessHandle || !guessProof) {
        showToast('Encryption output missing handle or proof', 'error');
        setLoading(false);
        setTxStatus('');
        return;
      }

      setTxStatus('Submitting playDice transaction...');
      const tx = await contract.playDice(
        seedHandle,
        seedProof,
        guessHandle,
        guessProof,
        { value: entryFeeWei ?? parseEther('0.0002') }
      );
      await tx.wait();

      showToast('Dice played successfully! ğŸ²', 'success');
      await refreshEncryptedState();
    } catch (err) {
      console.error('playDice failed:', err);
      showToast('playDice failed: ' + (err?.message || String(err)), 'error');
    } finally {
      setLoading(false);
      setTxStatus('');
    }
  };

  const decryptLastDiceRoll = async () => {
    if (!encryptedState.lastDiceRoll || encryptedState.lastDiceRoll === '0x') return;
    setTxStatus('Decrypting last dice roll...');
    try {
      const value = await userDecryptValue(encryptedState.lastDiceRoll, 'uint32');
      setDecryptedState(prev => ({ ...prev, lastDiceRoll: Number(value) }));
      showToast('Decrypted last roll âœ…', 'success');
    } catch (err) {
      console.error('Decrypt last roll failed:', err);
      showToast('Decrypt failed: ' + (err?.message || String(err)), 'error');
    } finally {
      setTxStatus('');
    }
  };

  const decryptPlayerGuess = async () => {
    if (!encryptedState.playerGuess || encryptedState.playerGuess === '0x') return;
    setTxStatus('Decrypting your guess...');
    try {
      const value = await userDecryptValue(encryptedState.playerGuess, 'uint32');
      setDecryptedState(prev => ({ ...prev, playerGuess: Number(value) }));
      showToast('Decrypted your guess âœ…', 'success');
    } catch (err) {
      console.error('Decrypt guess failed:', err);
      showToast('Decrypt failed: ' + (err?.message || String(err)), 'error');
    } finally {
      setTxStatus('');
    }
  };

  const decryptWinnerStatus = async () => {
    if (!encryptedState.winnerStatus || encryptedState.winnerStatus === '0x') return;
    setTxStatus('Decrypting winner status...');
    try {
      const value = await userDecryptValue(encryptedState.winnerStatus, 'bool');
      const isWinner = Boolean(value);
      setDecryptedState(prev => ({ ...prev, winnerStatus: isWinner }));
      showToast(isWinner ? 'ğŸ‰ You won!' : 'Not a winner this time', 'info');
    } catch (err) {
      console.error('Decrypt winner failed:', err);
      showToast('Decrypt failed: ' + (err?.message || String(err)), 'error');
    } finally {
      setTxStatus('');
    }
  };

  // Robust user decryption helper using EIP-712 flow
  const userDecryptValue = async (ciphertextHandle, valueType) => {
    await window.relayerSDK.initSDK();
    const config = { ...window.relayerSDK.SepoliaConfig, network: window.ethereum };
    const instance = await window.relayerSDK.createInstance(config);

    const provider = new BrowserProvider(window.ethereum);
    const signer = await provider.getSigner();
    const signerAddress = await signer.getAddress();

    const keypair = instance.generateKeypair();
    const handleContractPairs = [
      { handle: ciphertextHandle, contractAddress }
    ];
    const startTimeStamp = Math.floor(Date.now() / 1000).toString();
    const durationDays = '10';
    const contractAddresses = [contractAddress];

    const eip712 = instance.createEIP712(
      keypair.publicKey,
      contractAddresses,
      startTimeStamp,
      durationDays
    );

    const signature = await signer.signTypedData(
      eip712.domain,
      { UserDecryptRequestVerification: eip712.types.UserDecryptRequestVerification },
      eip712.message
    );

    const result = await instance.userDecrypt(
      handleContractPairs,
      keypair.privateKey,
      keypair.publicKey,
      signature.replace('0x', ''),
      contractAddresses,
      signerAddress,
      startTimeStamp,
      durationDays
    );

    const raw = result[ciphertextHandle];
    if (valueType === 'bool') {
      return raw === true || raw === 'true' || raw === 1 || raw === '1';
    }
    // Default to uint32 number
    return Number(raw);
  };

  return {
    contract,
    loading,
    encryptedState,
    decryptedState,
    playDice,
    refreshEncryptedState,
    decryptLastDiceRoll,
    decryptPlayerGuess,
    decryptWinnerStatus
  };
};
    ``` 

useToast.js
``` js
import { useState } from 'react';

export const useToast = () => {
  const [messages, setMessages] = useState([]);

  const showToast = (message, type = 'info') => {
    const id = Date.now();
    setMessages(prev => [...prev, { id, message, type }]);
    setTimeout(() => {
      setMessages(prev => prev.filter(msg => msg.id !== id));
    }, 5000);
  };

  return { messages, showToast };
};
```

useWallet.js
    ``` js
import { useState } from 'react';
import { BrowserProvider, Contract } from 'ethers';

export const useWallet = (showToast, contractAddress) => {
  const [account, setAccount] = useState('');
  const [isConnected, setIsConnected] = useState(false);

  // Contract ABI
  const contractABI = [
    "function buyTicket(uint8) payable",
    "function drawWinner()",
    "function claimPrize()",
    "function resetLottery()",
    "function getMyTicket() view returns (uint8)",
    "function getBalance() view returns (uint256)",
    "function getParticipantCount() view returns (uint256)",
    "function ticketPrice() view returns (uint256)",
    "function isDrawn() view returns (bool)",
    "function winner() view returns (address)",
    "function admin() view returns (address)"
  ];

  // Switch to Sepolia network
  const switchToSepolia = async () => {
    try {
      await window.ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: '0xaa36a7' }],
      });
    } catch (error) {
      if (error.code === 4902) {
        try {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: '0xaa36a7',
              chainName: 'Sepolia Testnet',
              nativeCurrency: { name: 'SepoliaETH', symbol: 'ETH', decimals: 18 },
              rpcUrls: ['https://sepolia.infura.io/v3/54d227d3f34347b5b4ba31bbfdb83093'],
              blockExplorerUrls: ['https://sepolia.etherscan.io/']
            }]
          });
        } catch (addError) {
          console.error("Error adding Sepolia network:", addError);
        }
      } else {
        console.error("Error switching to Sepolia:", error);
      }
    }
  };

  // Connect to MetaMask
  const connectWallet = async () => {
    if (!window.ethereum) {
      showToast('Please install MetaMask browser extension', 'error');
      return;
    }

    try {
      showToast('Connecting...', 'info');

      await switchToSepolia();

      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      setAccount(accounts[0]);
      setIsConnected(true);

      showToast('Wallet connected successfully!', 'success');

    } catch (error) {
      console.error("Error connecting wallet:", error);
      showToast('Connection failed: ' + error.message, 'error');
    }
  };

  return { account, isConnected, connectWallet };
};
```
## FOR CSS USE THIS
under src/app.css
https://limewire.com/d/2bQOQ#SYb3013QX4



### If you have follow along all way to this, You have successfully completed the journey of Deploying a 
Dapps using FHEVM powered by Zama
